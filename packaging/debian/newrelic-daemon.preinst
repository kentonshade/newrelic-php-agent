#!/bin/sh
# preinst script for newrelic-daemon
#
# see: dh_installdeb(1)

# If our log dir is currently a file move it aside
if [ -f /var/log/newrelic ]; then
  mv -f /var/log/newrelic /var/log/newrelic.f.old > /dev/null 2>&1
fi
if [ -x /etc/init.d/newrelic-daemon ]; then
  # We can't actually use the script due to previous bugs which killed too much
  pidlist=`ps -ef | grep '/newrelic-daemon ' | sed -e '/grep/d' | awk '{if ($3 == 1) {print $2;}}'`
  if [ -n "${pidlist}" ]; then
    for pid in $pidlist; do
      kill -15 $pid > /dev/null 2>&1
    done
  fi
fi
if [ -f /etc/newrelic/newrelic.cfg ]; then
  mv -f /etc/newrelic/newrelic.cfg /etc/newrelic/newrelic.cfg.preupgrade > /dev/null 2>&1
fi

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
